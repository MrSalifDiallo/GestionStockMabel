# ---------------------------------
# Déployer le dossier "backend"
# ---------------------------------

# Step 1: créer un répertoire temporaire
mkdir /tmp/monorepo_tmp

# Step 2: lister les sous-dossiers de ton monorepo
repos=("backend" "frontend")

# Step 3: déplacer tous les sous-dossiers dans /tmp
for item in "${repos[@]}"; do
  mv "$item" /tmp/monorepo_tmp/
done

# Step 4: copier le dossier backend dans la racine (où Cloud build)
cp -Rf /tmp/monorepo_tmp/backend/{.,}* .

# Step 5: nettoyer
rm -rf /tmp/monorepo_tmp

# Step 6: steps Laravel classiques
composer install --no-dev --prefer-dist --no-interaction --no-progress
npm install
npm run build
php artisan config:cache
php artisan route:cache
php artisan view:cache
